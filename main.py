import pandas as pd
from currency import get_usd_to_kgs

usd_to_kgs = get_usd_to_kgs()

data = [
    {"Банк": "МБанк", "Активы": 100_058_739.0, "Обязательства": 84_526_958.0, "Капитал": 15_531_781.0, "Доходы": 20_312_363.0, "Расходы": 7_577_858.0, "Чистая прибыль": 11_130_115.0},
    {"Банк": "Оптима Банк", "Активы": 73_359_151.0, "Обязательства": 57_402_279.0, "Капитал": 15_956_872.0, "Доходы": 7_230_224.0, "Расходы": 4_251_283.0, "Чистая прибыль": 2_659_312.0},
    {"Банк": "Элдик Банк", "Активы": 99_256_542.0, "Обязательства": 80_726_159.0, "Капитал": 18_530_383.0, "Доходы": 13_729_456.0, "Расходы": 8_072_615.0, "Чистая прибыль": 5_872_781.0},
    {"Банк": "Бакай Банк", "Активы": 86_509_594.0, "Обязательства": 76_899_774.0, "Капитал": 9_609_819.0, "Доходы": 7_458_361.0, "Расходы": 4_994_589.0, "Чистая прибыль": 2_463_812.0},
    {"Банк": "Керемет Банк", "Активы": 16_535_714.0, "Обязательства": 7_834_764.0, "Капитал": 8_700_950.0, "Доходы": 1_770_903.0, "Расходы": 970_509.0, "Чистая прибыль": 747_143.0},
    {"Банк": "ДосКредоБанк", "Активы": 11_678_210.0, "Обязательства": 9_889_027.0, "Капитал": 1_789_183.0, "Доходы": 2_045_927.0, "Расходы": 1_866_359.0, "Чистая прибыль": 266_467.0},
    {"Банк": "О Банк", "Активы": 21_252_091.0, "Обязательства": 48_749.0, "Капитал": 21_203_342.0, "Доходы": 1_157_596.0, "Расходы": 73_987.0, "Чистая прибыль": 1_083_609.0},
    {"Банк": "Айыл Банк", "Активы": 157_652_230.0, "Обязательства": 132_434_460.0, "Капитал": 25_217_770.0, "Доходы": 31_904_642.0, "Расходы": 8_865_123.0, "Чистая прибыль": 7_248_638.0},
]

records = []

for entry in data:
    bank = entry["Банк"]
    a = entry["Активы"]
    l = entry["Обязательства"]
    e = entry["Капитал"]
    i = entry["Доходы"]
    x = entry["Расходы"]
    p = entry["Чистая прибыль"]

    roa = p / a if a else 0
    roe = p / e if e else 0
    liquidity = e / l if l else 0
    debt_ratio = l / a if a else 0
    profitability = p / i if i else 0

    records.append({
        "Банк": bank,

        "Активы (млн сом)": round(a / 1_000_000, 2),
        "Обязательства (млн сом)": round(l / 1_000_000, 2),
        "Капитал (млн сом)": round(e / 1_000_000, 2),

        "Активы ($)": round(a / usd_to_kgs, 2),
        "Обязательства ($)": round(l / usd_to_kgs, 2),
        "Капитал ($)": round(e / usd_to_kgs, 2),

        "Доходы (млн сом)": round(i / 1_000_000, 2),
        "Расходы (млн сом)": round(x / 1_000_000, 2),
        "Чистая прибыль (млн сом)": round(p / 1_000_000, 2),

        "Доходы ($)": round(i / usd_to_kgs, 2),
        "Расходы ($)": round(x / usd_to_kgs, 2),
        "Чистая прибыль ($)": round(p / usd_to_kgs, 2),

        "ROA": round(roa, 4),
        "ROE": round(roe, 4),
        "Коэффициент ликвидности": round(liquidity, 4),
        "Коэффициент задолженности": round(debt_ratio, 4),
        "Коэффициент рентабельности": round(profitability, 4),
    })

df = pd.DataFrame(records)
df = df.sort_values("Банк")

df_long = df.melt(id_vars="Банк", var_name="Показатель", value_name="Значение")

df_long.to_excel("banks2024_powerbi.xlsx", index=False)
print("Файл успешно сохранён.")
print(df_long.head())
